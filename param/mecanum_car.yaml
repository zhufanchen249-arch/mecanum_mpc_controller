# MPC控制器核心配置（麦克纳姆轮专用）
# 适配全向移动场景，参数需根据实际机器人硬件性能调整

# -------------------------- 预测与采样参数 --------------------------
# 预测步长：MPC向前预测的步数（N），需满足 N*sampling_time < 轨迹规划周期
# 建议：麦克纳姆轮灵活性高，可适当减小（8-15步），降低计算量
prediction_horizon: 20

# 采样时间（秒）：控制周期，需与代码中control_rate保持一致（1/control_rate）
# 建议：麦克纳姆轮响应快，可设0.05-0.2s（对应5-20Hz），需匹配硬件计算能力
sampling_time: 0.05   # 频率20hz


# -------------------------- 状态约束（防止机器人超出物理极限） --------------------------
# 状态向量：[x, y, theta, vx, vy, omega]
# x/y：位置（米），theta：姿态角（弧度），vx：纵向速度（米/秒）
# vy：横向速度（米/秒，麦克纳姆轮核心参数），omega：角速度（弧度/秒）

state_constraints:
  # 状态向量对应：[x, y, theta, vx, vy, omega]
  x_min: [-10.0, -1.8, -3.14159, -0.3, -0.3, -0.5]  # 下界
  x_max: [10.0,  1.8,  3.14159,  0.3,  0.3,  0.5]  # 上界
  # 说明：
  # 1. x/y范围根据实际工作空间调整（如室内场景可设±5米）
  # 2. theta范围通常为±π（全向旋转）
  # 3. vx/vy/omega需小于机器人硬件最大能力（留10%余量）


# -------------------------- 控制输入约束（防止执行器过载） --------------------------
# 控制向量：[vx, vy, omega]（与状态向量中的速度对应）
control_constraints:
  # 对应：[vx, vy, omega]
  u_min: [-0.3, -0.3, -0.5]
  u_max: [0.3, 0.3, 0.5]
  # 麦克纳姆轮关键：vy约束必须非零（区别于传统车），且vx/vy/omega需满足：
  # 最大轮速 = sqrt(vx² + vy² + (omega*track_width/2)²) / wheel_radius
  # 需确保计算出的轮速不超过电机最大转速（见下方mecanum_wheel.max_speed）


# -------------------------- 代价函数权重（调整跟踪性能的核心） --------------------------
# 代价函数：J = Σ(x_err'*Q*x_err + u'*R*u + Δu'*Rd*Δu)
# x_err：状态误差，u：控制输入，Δu：控制输入变化量（防止突变）
weights:
  # Q：状态误差权重（向量，对应[x_err, y_err, theta_err, vx_err, vy_err, omega_err]）
  # 建议：位置误差（x/y）权重 > 姿态误差（theta）> 速度误差（vx/vy/omega）
  Q: 1.0   # 状态误差权重
  R: 10.0   # 控制输入权重


# -------------------------- 麦克纳姆轮硬件参数（必须与实际硬件一致） --------------------------
mecanum_wheel:
  radius: 0.05       # 轮子半径（米），需用卡尺精确测量
  track_width: 0.5   # 左右轮中心距离（米），影响角速度控制精度
  wheelbase: 0.3     # 前后轮中心距离（米），影响转向响应
  max_speed: 50.0    # 最大轮速（弧度/秒），由电机参数计算（转速(rpm)/60*2π）
  # 附加说明：
  # 1. 轮速计算公示：
  #    前左轮速 = (vx - vy - omega*(track_width+wheelbase)/2) / radius
  #    前右轮速 = (vx + vy + omega*(track_width+wheelbase)/2) / radius
  #    后左轮速 = (vx + vy - omega*(track_width+wheelbase)/2) / radius
  #    后右轮速 = (vx - vy + omega*(track_width+wheelbase)/2) / radius
  # 2. 若实际轮速超过max_speed，MPC会自动限幅（需代码中实现）


# -------------------------- MPC求解器参数（影响计算速度与稳定性） --------------------------
solver:
  max_iterations: 100    # 最大迭代次数（越多越精确，但耗时越长）
  tolerance: 1e-4        # 收敛容差（越小越精确，建议1e-3~1e-5）
  verbose: false         # 是否打印求解过程（调试时设为true）
  # 说明：对于嵌入式平台，建议减小max_iterations（如50）以保证实时性
